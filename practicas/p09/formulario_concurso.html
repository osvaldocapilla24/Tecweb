<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Relojes (Validación JS)</title>
</head>
<body>
  <h2>Registrar nuevo reloj</h2>

  <form id="formProducto">
    <label>Nombre:</label><br>
    <input type="text" id="nombre" name="nombre" maxlength="100" required><br><br>

    <label>Marca:</label><br>
    <select id="marca" name="marca" required>
      <option value="">-- Selecciona una marca --</option>
      <option value="Casio">Casio</option>
      <option value="Rolex">Rolex</option>
      <option value="Seiko">Seiko</option>
      <option value="Citizen">Citizen</option>
      <option value="Fossil">Fossil</option>
    </select><br><br>

    <label>Modelo:</label><br>
    <input type="text" id="modelo" name="modelo" maxlength="25" required><br><br>

    <label>Precio:</label><br>
    <input type="number" id="precio" name="precio" step="0.01" required><br><br>

    <label>Detalles:</label><br>
    <input type="text" id="detalles" name="detalles" maxlength="250" placeholder="Color, tipo de correa, material..."><br><br>

    <label>Unidades:</label><br>
    <input type="number" id="unidades" name="unidades" min="0" required><br><br>

    <label>Imagen:</label><br>
    <input type="text" id="imagen" name="imagen" placeholder="img/default.png"><br><br>

    <input type="submit" value="Guardar Reloj">
  </form>

  <p id="resultado"></p>

  <script>
    document.getElementById('formProducto').addEventListener('submit', function(e) {
      e.preventDefault();
      let valido = true;
      let mensaje = "";

      const nombre = document.getElementById('nombre').value.trim();
      const marca = document.getElementById('marca').value;
      const modelo = document.getElementById('modelo').value.trim();
      const precio = parseFloat(document.getElementById('precio').value);
      const detalles = document.getElementById('detalles').value.trim();
      const unidades = parseInt(document.getElementById('unidades').value);
      const imagen = document.getElementById('imagen').value.trim() || "img/default.png";

      // Validaciones
      if (nombre === "" || nombre.length > 100) {
        valido = false;
        mensaje += "❌ El nombre es requerido y debe tener máximo 100 caracteres.\n";
      }
      if (marca === "") {
        valido = false;
        mensaje += "❌ Debes seleccionar una marca.\n";
      }
      const regexModelo = /^[a-zA-Z0-9]+$/;
      if (!regexModelo.test(modelo) || modelo.length > 25) {
        valido = false;
        mensaje += "❌ El modelo debe ser alfanumérico y tener máximo 25 caracteres.\n";
      }
      if (isNaN(precio) || precio <= 99.99) {
        valido = false;
        mensaje += "❌ El precio debe ser mayor a 99.99.\n";
      }
      if (detalles.length > 250) {
        valido = false;
        mensaje += "❌ Los detalles deben tener máximo 250 caracteres.\n";
      }
      if (isNaN(unidades) || unidades < 0) {
        valido = false;
        mensaje += "❌ Las unidades deben ser un número mayor o igual a 0.\n";
      }

      if (!valido) {
        alert(mensaje);
        return;
      }

      const formData = new FormData(this);
      formData.set("imagen", imagen);

      fetch("http://localhost/tecweb/practicas/p08", {
        method: "POST",
        body: formData
      })
      .then(r => r.text())
      .then(data => {
        document.getElementById("resultado").textContent = "✅ Reloj guardado correctamente.";
        console.log(data);
        this.reset();
      })
      .catch(err => {
        document.getElementById("resultado").textContent = "❌ Error al guardar el reloj.";
        console.error(err);
      });
    });
  </script>
</body>
</html>
